{
  "version": 3,
  "sources": ["../../../../../app/routes/_layout+/_auth+/forgot-password.tsx"],
  "sourcesContent": ["// REMIX HMR BEGIN\nif (!window.$RefreshReg$ || !window.$RefreshSig$ || !window.$RefreshRuntime$) {\n  console.warn('remix:hmr: React Fast Refresh only works when the Remix compiler is running in development mode.');\n} else {\n  var prevRefreshReg = window.$RefreshReg$;\n  var prevRefreshSig = window.$RefreshSig$;\n  window.$RefreshReg$ = (type, id) => {\n    window.$RefreshRuntime$.register(type, \"\\\"app/routes/_layout+/_auth+/forgot-password.tsx\\\"\" + id);\n  }\n  window.$RefreshSig$ = window.$RefreshRuntime$.createSignatureFunctionForTransform;\n}\nvar _s = $RefreshSig$();\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\n  import.meta.hot = __hmr__.createHotContext(\n  //@ts-expect-error\n  \"app/routes/_layout+/_auth+/forgot-password.tsx\");\n  import.meta.hot.lastModified = \"1706962583481.2432\";\n}\n// REMIX HMR END\n\nimport { getFormProps, getInputProps, useForm } from '@conform-to/react';\nimport { getZodConstraint, parseWithZod } from '@conform-to/zod';\nimport * as E from '@react-email/components';\nimport { json, redirect } from '@remix-run/node';\nimport { Link, useFetcher } from '@remix-run/react';\nimport { AuthenticityTokenInput } from 'remix-utils/csrf/react';\nimport { HoneypotInputs } from 'remix-utils/honeypot/react';\nimport { z } from 'zod';\nimport { checkHoneypot, prisma, sendEmail, validateCSRF } from '~/app/core/server/index.server.ts';\nimport { EmailSchema, UsernameSchema } from '~/app/shared/schemas/index.ts';\nimport { ErrorList, Field, GeneralErrorBoundary, StatusButton } from '~/app/shared/ui/index.ts';\nimport { prepareVerification } from './verify.tsx';\nconst ForgotPasswordSchema = z.object({\n  usernameOrEmail: z.union([EmailSchema, UsernameSchema])\n});\nexport async function action({\n  request\n}) {\n  const formData = await request.formData();\n  await validateCSRF(formData, request.headers);\n  checkHoneypot(formData);\n  const submission = await parseWithZod(formData, {\n    schema: ForgotPasswordSchema.superRefine(async (data, ctx) => {\n      const user = await prisma.user.findFirst({\n        where: {\n          OR: [{\n            email: data.usernameOrEmail\n          }, {\n            username: data.usernameOrEmail\n          }]\n        },\n        select: {\n          id: true\n        }\n      });\n      if (!user) {\n        ctx.addIssue({\n          path: ['usernameOrEmail'],\n          code: z.ZodIssueCode.custom,\n          message: 'No user exists with this username or email'\n        });\n        return;\n      }\n    }),\n    async: true\n  });\n  if (submission.status !== 'success') {\n    return json({\n      result: submission.reply()\n    }, {\n      status: submission.status === 'error' ? 400 : 200\n    });\n  }\n  const {\n    usernameOrEmail\n  } = submission.value;\n  const user = await prisma.user.findFirstOrThrow({\n    where: {\n      OR: [{\n        email: usernameOrEmail\n      }, {\n        username: usernameOrEmail\n      }]\n    },\n    select: {\n      email: true,\n      username: true\n    }\n  });\n  const {\n    verifyUrl,\n    redirectTo,\n    otp\n  } = await prepareVerification({\n    period: 10 * 60,\n    request,\n    type: 'reset-password',\n    target: usernameOrEmail\n  });\n  const response = await sendEmail({\n    to: user.email,\n    subject: 'GeekConsole Password Reset',\n    react: <ForgotPasswordEmail onboardingUrl={verifyUrl.toString()} otp={otp} />\n  });\n  if (response.status === 'success') {\n    return redirect(redirectTo.toString());\n  } else {\n    return json({\n      result: submission.reply({\n        formErrors: [response.error.message]\n      })\n    }, {\n      status: 500\n    });\n  }\n}\nfunction ForgotPasswordEmail({\n  onboardingUrl,\n  otp\n}) {\n  return <E.Html lang=\"en\" dir=\"ltr\">\n\t\t\t<E.Container>\n\t\t\t\t<h1>\n\t\t\t\t\t<E.Text>GeekConsole Password Reset</E.Text>\n\t\t\t\t</h1>\n\t\t\t\t<p>\n\t\t\t\t\t<E.Text>\n\t\t\t\t\t\tHere's your verification code: <strong>{otp}</strong>\n\t\t\t\t\t</E.Text>\n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t<E.Text>Or click the link:</E.Text>\n\t\t\t\t</p>\n\t\t\t\t<E.Link href={onboardingUrl}>{onboardingUrl}</E.Link>\n\t\t\t</E.Container>\n\t\t</E.Html>;\n}\n_c = ForgotPasswordEmail;\nexport const meta = () => {\n  return [{\n    title: 'Password Recovery for GeekConsole'\n  }];\n};\nexport default function ForgotPasswordRoute() {\n  _s();\n  const forgotPassword = useFetcher();\n  const [form, fields] = useForm({\n    id: 'forgot-password-form',\n    constraint: getZodConstraint(ForgotPasswordSchema),\n    lastResult: forgotPassword.data?.result,\n    onValidate({\n      formData\n    }) {\n      return parseWithZod(formData, {\n        schema: ForgotPasswordSchema\n      });\n    },\n    shouldRevalidate: 'onBlur'\n  });\n  return <div className=\"container pb-32 pt-20\">\n\t\t\t<div className=\"flex flex-col justify-center\">\n\t\t\t\t<div className=\"text-center\">\n\t\t\t\t\t<h1 className=\"text-h1\">Forgot Password</h1>\n\t\t\t\t\t<p className=\"mt-3 text-body-md text-muted-foreground\">\n\t\t\t\t\t\tNo worries, we'll send you reset instructions.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"mx-auto mt-16 min-w-[368px] max-w-sm\">\n\t\t\t\t\t<forgotPassword.Form method=\"POST\" {...getFormProps(form)}>\n\t\t\t\t\t\t<AuthenticityTokenInput />\n\t\t\t\t\t\t<HoneypotInputs />\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Field labelProps={{\n              htmlFor: fields.usernameOrEmail.id,\n              children: 'Username or Email'\n            }} inputProps={{\n              autoFocus: true,\n              ...getInputProps(fields.usernameOrEmail, {\n                type: 'text'\n              })\n            }} errors={fields.usernameOrEmail.errors} />\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<ErrorList errors={form.errors} id={form.errorId} />\n\n\t\t\t\t\t\t<div className=\"mb-6\">\n\t\t\t\t\t\t\t<StatusButton className=\"w-full\" status={forgotPassword.state === 'submitting' ? 'pending' : form.status ?? 'idle'} type=\"submit\" disabled={forgotPassword.state !== 'idle'}>\n\t\t\t\t\t\t\t\tRecover password\n\t\t\t\t\t\t\t</StatusButton>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</forgotPassword.Form>\n\t\t\t\t\t<Link to=\"/login\" className=\"mt-11 text-center text-body-sm font-bold\">\n\t\t\t\t\t\tBack to Login\n\t\t\t\t\t</Link>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>;\n}\n_s(ForgotPasswordRoute, \"X2dFhDI9LNT9Wf5zf55NIkNQiO4=\", false, function () {\n  return [useFetcher, useForm];\n});\n_c2 = ForgotPasswordRoute;\nexport function ErrorBoundary() {\n  return <GeneralErrorBoundary />;\n}\n_c3 = ErrorBoundary;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"ForgotPasswordEmail\");\n$RefreshReg$(_c2, \"ForgotPasswordRoute\");\n$RefreshReg$(_c3, \"ErrorBoundary\");\n\nwindow.$RefreshReg$ = prevRefreshReg;\nwindow.$RefreshSig$ = prevRefreshSig;"],
  "mappings": "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",
  "names": ["Link"]
}
