{
  "version": 3,
  "sources": ["../../../../../../app/routes/_layout+/dashboard+/books+/$bookId.tsx"],
  "sourcesContent": ["// REMIX HMR BEGIN\nif (!window.$RefreshReg$ || !window.$RefreshSig$ || !window.$RefreshRuntime$) {\n  console.warn('remix:hmr: React Fast Refresh only works when the Remix compiler is running in development mode.');\n} else {\n  var prevRefreshReg = window.$RefreshReg$;\n  var prevRefreshSig = window.$RefreshSig$;\n  window.$RefreshReg$ = (type, id) => {\n    window.$RefreshRuntime$.register(type, \"\\\"app/routes/_layout+/dashboard+/books+/$bookId.tsx\\\"\" + id);\n  }\n  window.$RefreshSig$ = window.$RefreshRuntime$.createSignatureFunctionForTransform;\n}\nvar _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\n  import.meta.hot = __hmr__.createHotContext(\n  //@ts-expect-error\n  \"app/routes/_layout+/dashboard+/books+/$bookId.tsx\");\n  import.meta.hot.lastModified = \"1707021261437.3242\";\n}\n// REMIX HMR END\n\nimport { getFormProps, useForm } from '@conform-to/react';\nimport { parseWithZod } from '@conform-to/zod';\nimport { invariantResponse } from '@epic-web/invariant';\nimport { createId } from '@paralleldrive/cuid2';\nimport { json } from '@remix-run/node';\nimport { useLoaderData, Link, Form, useActionData } from '@remix-run/react';\nimport { formatDistanceToNow } from 'date-fns';\nimport { AuthenticityTokenInput } from 'remix-utils/csrf/react';\nimport { prisma, redirectWithToast, requireUserId, requireUserWithPermission, validateCSRF } from '~/app/core/server/index.server.ts';\nimport { useIsPending } from '~/app/shared/lib/hooks';\nimport { getBookImgSrc } from '~/app/shared/lib/utils';\nimport { DeleteBookFormSchema, DELETE_BOOK_INTENT } from '~/app/shared/schemas/index.ts';\nimport { Badge, Button, ErrorList, GeneralErrorBoundary, Icon, StatusButton } from '~/app/shared/ui/index.ts';\nexport const handle = {\n  breadcrumb: 'Overview',\n  getSitemapEntries: () => null\n};\nexport default function BookOverview() {\n  _s();\n  const {\n    book,\n    timeAgo\n  } = useLoaderData();\n  return <div>\n\t\t\t<article className=\"mx-auto flex items-center justify-start space-x-10 rounded-lg border bg-muted p-8 shadow-md\">\n\t\t\t\t<div className=\"overflow-y-auto pb-24\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span className=\"text-sm text-foreground/90 max-[524px]:hidden\">\n\t\t\t\t\t\t\t<Icon name=\"clock\" className=\"scale-125\">\n\t\t\t\t\t\t\t\t{timeAgo} ago\n\t\t\t\t\t\t\t</Icon>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<ul className=\"flex flex-wrap gap-5 py-5\">\n\t\t\t\t\t\t{book.images.length > 0 ? book.images.map((image, index) => <li key={image.id}>\n\t\t\t\t\t\t\t\t\t<a href={getBookImgSrc(image.id)}>\n\t\t\t\t\t\t\t\t\t\t<img src={getBookImgSrc(image.id)} alt={image.altText ?? `${book.title}/${index + 1}`} className=\"size-32 rounded-lg object-cover\" />\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</li>) : <li>\n\t\t\t\t\t\t\t\t<img src={getBookImgSrc(null)} alt=\"Placeholder\" className=\"w-32 rounded-lg\" />\n\t\t\t\t\t\t\t</li>}\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"w-3/4\">\n\t\t\t\t\t<h2 className=\"mb-4 text-left text-xl font-bold tracking-tight text-foreground lg:text-2xl\">\n\t\t\t\t\t\t{book.title}\n\t\t\t\t\t</h2>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h4 className=\"font-bold\">Author</h4>\n\t\t\t\t\t\t<p className=\"mb-3 font-light text-muted-foreground\">\n\t\t\t\t\t\t\t{book.author}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h4 className=\"font-bold \">Year</h4>\n\t\t\t\t\t\t<p className=\"mb-3 font-light text-muted-foreground\">{book.year}</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h4 className=\"font-bold\">Description</h4>\n\t\t\t\t\t\t<p className=\"mb-3 font-light text-muted-foreground\">\n\t\t\t\t\t\t\t{book.description ? book.description : 'Description is not provided.'}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h4 className=\"font-bold\">Your comments</h4>\n\t\t\t\t\t\t<p className=\"mb-3 font-light text-muted-foreground\">\n\t\t\t\t\t\t\t{book.comment ? book.comment : 'No comments yet. Add one!'}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<Badge className=\"mb-3\">{book.status.name}</Badge>\n\n\t\t\t\t\t<div className=\"flex gap-4\">\n\t\t\t\t\t\t<DeleteBook id={book.id} />\n\n\t\t\t\t\t\t<Button asChild className=\"min-[525px]:max-md:aspect-square min-[525px]:max-md:px-0\">\n\t\t\t\t\t\t\t<Link to=\"edit\">\n\t\t\t\t\t\t\t\t<Icon name=\"pencil-1\" className=\"scale-125 max-md:scale-150\">\n\t\t\t\t\t\t\t\t\t<span className=\"max-md:hidden\">Edit</span>\n\t\t\t\t\t\t\t\t</Icon>\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</article>\n\t\t</div>;\n}\n_s(BookOverview, \"K6rXzravBrYGZbTgc0YjSh+jeVg=\", false, function () {\n  return [useLoaderData];\n});\n_c = BookOverview;\nexport function DeleteBook({\n  id\n}) {\n  _s2();\n  const actionData = useActionData();\n  const isPending = useIsPending();\n  const [form] = useForm({\n    id: 'deleteBook',\n    lastResult: actionData?.result\n  });\n  return <Form method=\"POST\" {...getFormProps(form)}>\n\t\t\t<AuthenticityTokenInput />\n\t\t\t<input type=\"hidden\" name=\"bookId\" value={id} />\n\t\t\t<StatusButton type=\"submit\" name=\"intent\" value={DELETE_BOOK_INTENT} variant=\"destructive\" status={isPending ? 'pending' : form.status ?? 'idle'} disabled={isPending} className=\"w-full max-md:aspect-square max-md:px-0\">\n\t\t\t\t<Icon name=\"trash\" className=\"scale-125 max-md:scale-150\">\n\t\t\t\t\t<span className=\"max-md:hidden\">Delete</span>\n\t\t\t\t</Icon>\n\t\t\t</StatusButton>\n\t\t\t<ErrorList errors={form.errors} id={form.errorId} />\n\t\t</Form>;\n}\n_s2(DeleteBook, \"G+LY8oKPtG3PTaudrP2QM73mqkI=\", false, function () {\n  return [useActionData, useIsPending, useForm];\n});\n_c2 = DeleteBook;\nexport const loader = async ({\n  params\n}) => {\n  const book = await prisma.book.findUnique({\n    where: {\n      id: params.bookId\n    },\n    select: {\n      id: true,\n      title: true,\n      author: true,\n      year: true,\n      status: {\n        select: {\n          name: true\n        }\n      },\n      description: true,\n      comment: true,\n      ownerId: true,\n      updatedAt: true,\n      images: {\n        select: {\n          id: true,\n          altText: true\n        }\n      }\n    }\n  });\n  invariantResponse(book, 'Not found', {\n    status: 404\n  });\n  const date = new Date(book.updatedAt);\n  const timeAgo = formatDistanceToNow(date);\n  return json({\n    book,\n    timeAgo\n  });\n};\nexport const action = async ({\n  request\n}) => {\n  const userId = await requireUserId(request);\n  const formData = await request.formData();\n  await validateCSRF(formData, request.headers);\n  const submission = parseWithZod(formData, {\n    schema: DeleteBookFormSchema\n  });\n  if (submission.status !== 'success') {\n    return json({\n      result: submission.reply()\n    }, {\n      status: submission.status === 'error' ? 400 : 200\n    });\n  }\n  const {\n    bookId\n  } = submission.value;\n  const book = await prisma.book.findFirst({\n    select: {\n      id: true,\n      ownerId: true\n    },\n    where: {\n      id: bookId\n    }\n  });\n  invariantResponse(book, 'Not found', {\n    status: 404\n  });\n  const isOwner = userId === book.ownerId;\n  await requireUserWithPermission(request, isOwner ? 'delete:book:own' : 'delete:book:any');\n  await prisma.book.delete({\n    where: {\n      id: book.id\n    }\n  });\n  return redirectWithToast('/dashboard/books/collection', {\n    id: createId(),\n    type: 'success',\n    title: 'Book deleted',\n    description: 'Your book has been deleted'\n  });\n};\nexport const meta = ({\n  data\n}) => {\n  const bookName = data?.book.title ?? 'Book';\n  const bookSummary = data && data.book.description && data.book.description.length > 100 ? data.book.description.slice(0, 97) + '...' : 'No description';\n  return [{\n    title: `${bookName} | GeekConsole`\n  }, {\n    name: 'description',\n    content: bookSummary\n  }];\n};\nexport function ErrorBoundary() {\n  return <GeneralErrorBoundary statusHandlers={{\n    403: () => <p>You are not allowed to do that</p>,\n    404: ({\n      params\n    }) => <p>No book with the id \"{params.bookId}\" exists</p>\n  }} />;\n}\n_c3 = ErrorBoundary;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"BookOverview\");\n$RefreshReg$(_c2, \"DeleteBook\");\n$RefreshReg$(_c3, \"ErrorBoundary\");\n\nwindow.$RefreshReg$ = prevRefreshReg;\nwindow.$RefreshSig$ = prevRefreshSig;"],
  "mappings": "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",
  "names": []
}
